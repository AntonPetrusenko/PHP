docker-compose up -d --build

# Создаем пользователя и базу данных
docker exec -it otus-postgres bash
psql -Upostgres
create user cinema with password 'md56c14da109e294d1e8155be8aa4b1ce8e';
create database cinema owner cinema;
\q

# Импортируем структуру таблиц
psql -U cinema cinema < sql/dql.sql
\q
exit

# Импортируем данные php скирптом (10000)
docker exec -it otus-php-fpm bash
php src/filldb.php 10000

# Анализируем запросы

# Импортируем данные php скирптом (10000000)




#--------------------------

Индексы и анализ производительности
Подготовить список из 6 основных запросов к БД, разработанной на предыдущих занятиях. Целесообразно выбрать 3 "простых" (задействована 1 таблица), 3 "сложных" (агрегатные функции, связи таблиц).



- рецензии (текстовые значения) - рецензии критиков, отзыв неизвестной киноакадемии ...
- премия (заменяется при печати баннеров и билетов на изображение, логическое значение) - оскар, ника ...
- "важные даты" даты (при печати - наименование атрибута и значение даты, тип дата) - мировая премьера, премьера в РФ ...
- служебные даты (используются при планировании, тип дата) - дата начала продажи билетов, когда запускать рекламу на ТВ ...
View сборки служебных данных в форме (три колонки):
- фильм, задачи актуальные на сегодня, задачи актуальные через 20 дней
View сборки данных для маркетинга в форме (три колонки):
- фильм, тип атрибута, атрибут, значение (значение выводим как текст)





Скрипт для наполнения основных таблиц БД тестовыми данными.
Заполнить таблицы, увеличив общее количество строк текстовых данных до 10000.
Провести анализ производительности запросов к БД, сохранить планы выполнения.
Заполнить таблицы, увеличив общее количество строк текстовых данных до 10000000.
Провести анализ производительности запросов к БД, сохранить планы выполнения.
На основе анализа запросов и планов предложить оптимизации (индексы, структура, параметры и др.), выполнить их, сравнить результат (планы выполнения).


Критерии оценки: Результат:
- скрипт создания БД (с предыдущих занятий)
- скрипт заполнения БД тестовыми данными
- таблица с результатами по каждому из 6 запросов
- запрос
- план на БД до 10000 строк
- план на БД до 10000000 строк
- план на БД до 10000000 строк, что удалось улучшить
- перечень оптимизаций с пояснениями
- отсортированный список (15 значений) самых больших по размеру объектов БД (таблицы, включая индексы, сами индексы)
- отсортированные списки (по 5 значений) самых часто и редко используемых индексов